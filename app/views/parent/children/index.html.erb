<main>
  <h1><%= t("parent.dashboard.title") %></h1>

  <% if @open_cards_count.to_i > 0 %>
    <article class="alert">
      <p><strong><%= t("parent.dashboard.open_cards", count: @open_cards_count) %></strong></p>
    </article>
  <% end %>

  <% @children.each do |child| %>
    <article>
      <h2><%= child.user.email %></h2>

      <% card = child.sticker_cards.order(created_at: :desc).first %>
      <% total_stickers = card.positive_count %>
      <% needed = card.required_stickers %>

      <p><%= t("parent.dashboard.progress", current: total_stickers, total: needed) %></p>

      <% if card.completed? && !card.reward_given? %>
        <%= button_to t("parent.actions.mark_rewarded"), parent_child_reward_path(child), method: :post %>
      <% else %>
        <%= button_to t("parent.actions.give_sticker"), parent_child_sticker_path(child),
                      method: :post,
                      params: { emoji_mode: "random" } %>

        <%= button_to t("parent.actions.give_penalty"), parent_child_penalty_path(child),
                      method: :post %>

        <%= link_to t("parent.actions.view_history"), parent_child_history_path(child) %>
      <% end %>
    </article>
  <% end %>

  <%= button_to t("common.logout"), session_path, method: :delete %>
</main>
